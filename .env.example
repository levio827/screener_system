# ============================================================================
# Stock Screening Platform - Environment Variables
# ============================================================================
# Copy this file to .env and update with your actual values
# DO NOT commit .env to version control!
# ============================================================================

# ============================================================================
# GENERAL
# ============================================================================

ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=INFO

# ============================================================================
# SEED DATA (Development/Testing)
# ============================================================================
# Set to 1 to automatically load seed data on first database initialization
# Seed data includes: 150 stocks, 27,000 price records, 600 financials, 150 indicators
LOAD_SEED_DATA=0

# ============================================================================
# DATABASE (PostgreSQL + TimescaleDB)
# ============================================================================

DB_HOST=localhost
DB_PORT=5432
DB_NAME=screener_db
DB_USER=screener_user
DB_PASSWORD=your_secure_password_here

# Full connection string (alternative to individual vars)
# Use postgresql+asyncpg for async SQLAlchemy
DATABASE_URL=postgresql+asyncpg://screener_user:your_secure_password_here@localhost:5432/screener_db

# ============================================================================
# REDIS CACHE
# ============================================================================

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password_here
REDIS_URL=redis://:your_redis_password_here@localhost:6379/0

# ============================================================================
# BACKEND API (FastAPI)
# ============================================================================

BACKEND_PORT=8000
API_BASE_URL=http://localhost:8000

# JWT Authentication
SECRET_KEY=your-super-secret-key-min-32-chars-change-this-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=30

# CORS
CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# Rate Limiting - Tier-based limits (requests per hour)
RATE_LIMIT_FREE=100
RATE_LIMIT_BASIC=1000
RATE_LIMIT_PRO=10000
RATE_LIMIT_WINDOW=3600  # Time window in seconds (3600 = 1 hour)

# Rate Limiting - Per-endpoint limits (requests per hour)
RATE_LIMIT_SCREENING=50      # Complex screening queries
RATE_LIMIT_STOCK_DETAIL=200  # Individual stock details
RATE_LIMIT_AUTH=10           # Authentication endpoints

# Paths that should not be rate limited (comma-separated)
RATE_LIMIT_WHITELIST_PATHS=/health,/health/db,/health/redis,/docs,/redoc,/openapi.json

# KIS API Quota Management
KIS_API_RATE_LIMIT=20              # Max requests per second
KIS_API_QUOTA_WINDOW=1             # Time window in seconds
KIS_API_ENABLE_QUEUE=true          # Enable request queuing when quota exceeded
KIS_API_QUEUE_TIMEOUT=30           # Queue timeout in seconds

# KIS API Circuit Breaker
KIS_API_CIRCUIT_BREAKER_THRESHOLD=5   # Failures before opening circuit
KIS_API_CIRCUIT_BREAKER_TIMEOUT=60    # Seconds to wait before retry

# ============================================================================
# FRONTEND (React/Vite)
# ============================================================================

FRONTEND_PORT=5173
VITE_API_BASE_URL=http://localhost:8000
VITE_WS_URL=ws://localhost:8000/ws

# ============================================================================
# DATA PIPELINE (Apache Airflow)
# ============================================================================

AIRFLOW_PORT=8080
AIRFLOW_USER=admin
AIRFLOW_PASSWORD=admin
AIRFLOW_FERNET_KEY=your-fernet-key-here-generate-with-python-cryptography-fernet
AIRFLOW_SECRET_KEY=your-airflow-secret-key-here

# Airflow Database (uses same PostgreSQL instance)
AIRFLOW__DATABASE__SQL_ALCHEMY_CONN=postgresql://screener_user:your_secure_password_here@localhost:5432/airflow

# Screener Database Connection (for Airflow DAGs)
# These are used by setup_connections.py to configure Airflow connection
SCREENER_DB_HOST=postgres
SCREENER_DB_PORT=5432
SCREENER_DB_NAME=screener_db
SCREENER_DB_USER=screener_user
SCREENER_DB_PASSWORD=your_secure_password_here

# To generate Fernet key:
# python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"

# ============================================================================
# CELERY (Background Tasks)
# ============================================================================

CELERY_BROKER_URL=redis://:your_redis_password_here@localhost:6379/1
CELERY_RESULT_BACKEND=redis://:your_redis_password_here@localhost:6379/2
CELERY_CONCURRENCY=4

# ============================================================================
# EXTERNAL DATA SOURCES
# ============================================================================

# Data Source Selection for Airflow DAGs
# Options:
#   kis  - Korea Investment & Securities API (production, requires credentials)
#   krx  - Korea Exchange API (legacy, batch daily data)
#   mock - Mock data for development/testing
#
# Leave empty for auto-detection:
#   - Uses KIS if KIS_APP_KEY and KIS_APP_SECRET are set
#   - Falls back to mock data if no credentials found
#
# Note: KIS API integration uses DataSourceFactory for abstraction
DATA_SOURCE_TYPE=

# Korea Exchange (KRX) API
KRX_API_KEY=your_krx_api_key_here
KRX_API_URL=https://api.krx.co.kr
KRX_USE_MOCK=false

# Korea Investment & Securities (KIS) API
# Real-time stock data integration
# Apply for API key at: https://apiportal.koreainvestment.com/
KIS_APP_KEY=your_kis_app_key_here
KIS_APP_SECRET=your_kis_app_secret_here
KIS_ACCOUNT_NUMBER=your_account_number_here  # Optional, only needed for trading

# Use virtual server for development/testing (모의투자)
# Virtual server: https://openapivts.koreainvestment.com:29443
# Real server: https://openapi.koreainvestment.com:9443
KIS_USE_VIRTUAL_SERVER=true
KIS_API_BASE_URL_REAL=https://openapi.koreainvestment.com:9443
KIS_API_BASE_URL_VIRTUAL=https://openapivts.koreainvestment.com:29443

# KIS API Cache TTL (seconds)
KIS_CACHE_TTL_PRICE=1800        # Current price: 30 minutes
KIS_CACHE_TTL_ORDERBOOK=10      # Order book: 10 seconds
KIS_CACHE_TTL_CHART=3600        # Chart data: 1 hour
KIS_CACHE_TTL_STOCK_INFO=86400  # Stock info: 24 hours

# F&Guide Financial Data API
FGUIDE_API_KEY=your_fguide_api_key_here
FGUIDE_API_URL=https://api.fguide.com

# ============================================================================
# MONITORING & LOGGING
# ============================================================================

# Prometheus
PROMETHEUS_PORT=9090

# Grafana
GRAFANA_PORT=3001
GRAFANA_USER=admin
GRAFANA_PASSWORD=admin

# Sentry (Error Tracking)
SENTRY_DSN=https://your-sentry-dsn-here@sentry.io/project-id
SENTRY_ENVIRONMENT=development

# ============================================================================
# EMAIL NOTIFICATIONS
# ============================================================================

SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=alerts@screener.kr
SMTP_PASSWORD=your_app_password_here
SMTP_FROM=alerts@screener.kr

# ============================================================================
# PAYMENT GATEWAY
# ============================================================================

# Stripe (or local payment provider)
STRIPE_PUBLIC_KEY=pk_test_your_stripe_public_key_here
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key_here
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here

# ============================================================================
# CLOUD STORAGE (Optional)
# ============================================================================

# AWS S3 (for data backups, exports)
AWS_ACCESS_KEY_ID=your_aws_access_key_here
AWS_SECRET_ACCESS_KEY=your_aws_secret_key_here
AWS_REGION=ap-northeast-2
AWS_S3_BUCKET=screener-data-backups

# ============================================================================
# NGINX (Reverse Proxy)
# ============================================================================

NGINX_PORT=80
NGINX_SSL_PORT=443

# ============================================================================
# TESTING
# ============================================================================

# Test Database
TEST_DATABASE_URL=postgresql://screener_user:test_password@localhost:5432/screener_test_db

# ============================================================================
# FEATURE FLAGS
# ============================================================================

ENABLE_SOCIAL_LOGIN=false
ENABLE_BACKTESTING=false
ENABLE_API_ACCESS=false
ENABLE_MOBILE_APP=false

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================

# Database connection pool
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10

# Cache TTL (seconds)
CACHE_TTL_HOT_STOCKS=300
CACHE_TTL_STOCK_DETAIL=3600
CACHE_TTL_SCREENING=600

# ============================================================================
# NOTES
# ============================================================================

# Generate secure keys:
# - SECRET_KEY: openssl rand -hex 32
# - AIRFLOW_FERNET_KEY: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# - Redis password: openssl rand -base64 32

# For production, use a secrets management service (AWS Secrets Manager, HashiCorp Vault, etc.)
