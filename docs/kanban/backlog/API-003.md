# API-003: API Documentation Portal

## Metadata

| Field | Value |
|-------|-------|
| **ID** | API-003 |
| **Title** | Build Developer Documentation Portal |
| **Type** | Documentation |
| **Status** | BACKLOG |
| **Priority** | P1 (High) |
| **Estimate** | 12 hours |
| **Sprint** | Sprint 8 |
| **Epic** | Developer API |
| **Assignee** | TBD |
| **Depends On** | API-002 |
| **Blocks** | - |
| **Tags** | `documentation`, `swagger`, `openapi`, `developer-experience`, `portal` |
| **Created** | 2025-11-29 |
| **Updated** | 2025-11-30 |

## Description

Build a comprehensive developer documentation portal that serves as the central hub for API documentation, guides, code examples, and interactive testing. The portal should enable developers to quickly understand, integrate, and test the API without leaving the documentation site.

The portal must include:
- **Auto-generated API Reference** - OpenAPI/Swagger documentation
- **Interactive API Tester** - Try endpoints directly from docs
- **Getting Started Guide** - Quick onboarding for new developers
- **Code Examples** - Python, JavaScript, cURL samples
- **Authentication Guide** - API key management and security
- **Rate Limiting Info** - Understand quotas and limits
- **Changelog** - Track API changes and migrations

## Subtasks

### 1. OpenAPI/Swagger Setup
- [ ] **Configure OpenAPI 3.0 Generator**
  - [ ] Install Swagger UI / ReDoc
  - [ ] Configure auto-generation from FastAPI
  - [ ] Add custom branding and styling
  - [ ] Enable deep linking to endpoints
  - [ ] Add search functionality
- [ ] **Enhance API Metadata**
  - [ ] Add detailed endpoint descriptions
  - [ ] Include request/response examples
  - [ ] Document all query parameters
  - [ ] Add authentication requirements
  - [ ] Document error responses
- [ ] **Schema Definitions**
  - [ ] Define all data models
  - [ ] Add field descriptions and constraints
  - [ ] Include example values
  - [ ] Document nested objects
  - [ ] Add enum values

### 2. Interactive API Tester
- [ ] **Swagger UI Integration**
  - [ ] Enable "Try it out" functionality
  - [ ] Add API key input field
  - [ ] Configure CORS for testing
  - [ ] Add request/response preview
  - [ ] Enable download response
- [ ] **Testing Sandbox**
  - [ ] Provide test API keys
  - [ ] Create sample data for testing
  - [ ] Add pre-filled example requests
  - [ ] Show real-time request/response
  - [ ] Add cURL command generator
- [ ] **Response Visualization**
  - [ ] Syntax highlighting for JSON
  - [ ] Collapsible response sections
  - [ ] Response time display
  - [ ] Status code highlighting
  - [ ] Header inspection

### 3. Getting Started Guide
- [ ] **Quick Start Tutorial**
  - [ ] Write step-by-step onboarding
  - [ ] Include API key generation
  - [ ] Show first API call example
  - [ ] Explain response structure
  - [ ] Link to full documentation
- [ ] **Installation Instructions**
  - [ ] Python SDK installation
  - [ ] JavaScript SDK installation
  - [ ] cURL setup for testing
  - [ ] Postman collection import
  - [ ] Environment setup guide
- [ ] **First Integration Examples**
  - [ ] "Hello World" API call
  - [ ] Stock data retrieval
  - [ ] Simple screening query
  - [ ] Error handling example
  - [ ] Rate limit handling

### 4. Code Examples & Samples
- [ ] **Python Examples**
  - [ ] SDK installation and setup
  - [ ] Authentication example
  - [ ] Stock data retrieval
  - [ ] Screening with filters
  - [ ] Webhook registration
  - [ ] Error handling patterns
  - [ ] Pagination handling
  - [ ] Async/await examples
- [ ] **JavaScript Examples**
  - [ ] SDK installation (npm/yarn)
  - [ ] Browser and Node.js usage
  - [ ] Authentication setup
  - [ ] React hooks integration
  - [ ] Fetch/Axios examples
  - [ ] Error handling
  - [ ] TypeScript usage
- [ ] **cURL Examples**
  - [ ] Basic authentication
  - [ ] GET requests with parameters
  - [ ] POST requests with JSON
  - [ ] Header configuration
  - [ ] Response parsing with jq

### 5. Authentication Guide
- [ ] **API Key Management**
  - [ ] How to generate API keys
  - [ ] Key rotation best practices
  - [ ] Revoking compromised keys
  - [ ] Managing multiple keys
  - [ ] Environment-specific keys
- [ ] **Security Best Practices**
  - [ ] Storing keys securely
  - [ ] Using environment variables
  - [ ] Avoiding key exposure in code
  - [ ] HTTPS requirement
  - [ ] IP whitelisting (if available)
- [ ] **Authentication Methods**
  - [ ] Header-based authentication
  - [ ] Query parameter authentication
  - [ ] Token refresh (if applicable)
  - [ ] OAuth integration (future)

### 6. Rate Limiting Documentation
- [ ] **Rate Limit Tiers**
  - [ ] Free tier limits
  - [ ] Pro tier limits
  - [ ] Enterprise tier limits
  - [ ] Comparison table
- [ ] **Rate Limit Headers**
  - [ ] X-RateLimit-Limit explanation
  - [ ] X-RateLimit-Remaining usage
  - [ ] X-RateLimit-Reset timing
  - [ ] Retry-After header
- [ ] **Handling Rate Limits**
  - [ ] Exponential backoff strategy
  - [ ] Retry logic examples
  - [ ] Queue management
  - [ ] Caching strategies

### 7. Changelog & Migration Guides
- [ ] **Version History**
  - [ ] Document all API versions
  - [ ] List changes per version
  - [ ] Mark breaking changes
  - [ ] Add migration deadlines
- [ ] **Migration Guides**
  - [ ] v1 to v2 migration (future)
  - [ ] Deprecated endpoint alternatives
  - [ ] Breaking change workarounds
  - [ ] Backward compatibility notes
- [ ] **Release Notes**
  - [ ] New features
  - [ ] Bug fixes
  - [ ] Performance improvements
  - [ ] Security updates

### 8. Portal Infrastructure
- [ ] **Static Site Generator**
  - [ ] Choose framework (Docusaurus, MkDocs, Sphinx)
  - [ ] Setup documentation structure
  - [ ] Configure theming and branding
  - [ ] Add search functionality
  - [ ] Enable version switcher
- [ ] **Hosting & Deployment**
  - [ ] Deploy to docs.thescreener.com
  - [ ] Configure CDN
  - [ ] Setup SSL certificate
  - [ ] Implement caching strategy
  - [ ] Add analytics tracking
- [ ] **Feedback Mechanism**
  - [ ] Add "Was this helpful?" buttons
  - [ ] Enable doc comments
  - [ ] Create feedback form
  - [ ] Track documentation issues
  - [ ] Link to support channels

## Implementation Details

### OpenAPI Specification Enhancement

**Enhanced FastAPI Configuration:**
```python
from fastapi import FastAPI
from fastapi.openapi.utils import get_openapi

app = FastAPI(
    title="TheScreener API",
    description="""
    TheScreener API provides access to comprehensive Korean stock market data,
    screening tools, and real-time market insights.

    ## Features

    * **Stock Data** - Access detailed information for all KOSPI/KOSDAQ stocks
    * **Technical Indicators** - Pre-calculated technical analysis indicators
    * **Screening** - Powerful filtering and screening engine
    * **Market Data** - Indices, sectors, and market statistics
    * **Webhooks** - Real-time notifications for price alerts

    ## Authentication

    All API requests require an API key. Include your key in the `X-API-Key` header:

    ```
    X-API-Key: your_api_key_here
    ```

    [Get your API key →](https://thescreener.com/settings/api)

    ## Rate Limits

    - Free tier: 100 requests/hour
    - Pro tier: 1000 requests/hour
    - Enterprise: Custom limits

    ## Support

    - Email: api-support@thescreener.com
    - Discord: [Join our community](https://discord.gg/thescreener)
    - GitHub: [Report issues](https://github.com/thescreener/api-issues)
    """,
    version="1.0.0",
    terms_of_service="https://thescreener.com/terms",
    contact={
        "name": "API Support",
        "email": "api-support@thescreener.com",
        "url": "https://thescreener.com/support"
    },
    license_info={
        "name": "Proprietary",
        "url": "https://thescreener.com/license"
    },
    servers=[
        {
            "url": "https://api.thescreener.com",
            "description": "Production server"
        },
        {
            "url": "https://api-staging.thescreener.com",
            "description": "Staging server"
        }
    ]
)

def custom_openapi():
    """Generate custom OpenAPI schema with enhanced metadata."""
    if app.openapi_schema:
        return app.openapi_schema

    openapi_schema = get_openapi(
        title=app.title,
        version=app.version,
        description=app.description,
        routes=app.routes,
    )

    # Add custom extensions
    openapi_schema["x-logo"] = {
        "url": "https://thescreener.com/logo.png",
        "altText": "TheScreener Logo"
    }

    # Add security schemes
    openapi_schema["components"]["securitySchemes"] = {
        "ApiKeyAuth": {
            "type": "apiKey",
            "in": "header",
            "name": "X-API-Key",
            "description": "API key for authentication. Get yours at https://thescreener.com/settings/api"
        }
    }

    # Add global security requirement
    openapi_schema["security"] = [{"ApiKeyAuth": []}]

    # Add tags with descriptions
    openapi_schema["tags"] = [
        {
            "name": "stocks",
            "description": "Operations related to stock data and information",
            "externalDocs": {
                "description": "Stock API Guide",
                "url": "https://docs.thescreener.com/stocks"
            }
        },
        {
            "name": "screening",
            "description": "Stock screening and filtering operations",
            "externalDocs": {
                "description": "Screening Guide",
                "url": "https://docs.thescreener.com/screening"
            }
        },
        {
            "name": "market",
            "description": "Market indices and sector information"
        },
        {
            "name": "webhooks",
            "description": "Webhook registration and management"
        }
    ]

    app.openapi_schema = openapi_schema
    return app.openapi_schema

app.openapi = custom_openapi
```

**Enhanced Endpoint Documentation:**
```python
from fastapi import APIRouter, Query
from pydantic import BaseModel, Field
from typing import List, Optional

class Stock(BaseModel):
    """Stock information model."""
    code: str = Field(..., example="005930", description="6-digit stock code")
    name: str = Field(..., example="Samsung Electronics", description="Company name")
    market: str = Field(..., example="KOSPI", description="Market (KOSPI/KOSDAQ)")
    sector: str = Field(..., example="Technology", description="Industry sector")
    current_price: float = Field(..., example=75000, description="Current stock price in KRW")
    market_cap: int = Field(..., example=500000000000000, description="Market capitalization in KRW")
    per: Optional[float] = Field(None, example=12.5, description="Price-to-Earnings ratio")
    pbr: Optional[float] = Field(None, example=1.8, description="Price-to-Book ratio")
    roe: Optional[float] = Field(None, example=15.2, description="Return on Equity percentage")

    class Config:
        schema_extra = {
            "example": {
                "code": "005930",
                "name": "Samsung Electronics",
                "market": "KOSPI",
                "sector": "Technology",
                "current_price": 75000,
                "market_cap": 500000000000000,
                "per": 12.5,
                "pbr": 1.8,
                "roe": 15.2
            }
        }

@router.get(
    "/stocks/{code}",
    response_model=Stock,
    tags=["stocks"],
    summary="Get stock details",
    description="""
    Retrieve detailed information for a specific stock by its code.

    The stock code must be a 6-digit Korean stock code (e.g., 005930 for Samsung Electronics).

    **Response includes:**
    - Basic information (name, market, sector)
    - Current price and market capitalization
    - Valuation metrics (PER, PBR, ROE)

    **Caching:**
    - Response is cached for 5 minutes
    - Check `ETag` header for cache validation
    """,
    responses={
        200: {
            "description": "Stock found and returned successfully",
            "content": {
                "application/json": {
                    "example": {
                        "success": True,
                        "data": {
                            "code": "005930",
                            "name": "Samsung Electronics",
                            "market": "KOSPI",
                            "sector": "Technology",
                            "current_price": 75000,
                            "market_cap": 500000000000000,
                            "per": 12.5,
                            "pbr": 1.8,
                            "roe": 15.2
                        }
                    }
                }
            }
        },
        404: {
            "description": "Stock not found",
            "content": {
                "application/json": {
                    "example": {
                        "success": False,
                        "error": {
                            "code": 4301,
                            "message": "Stock not found",
                            "details": "Stock code 999999 does not exist"
                        }
                    }
                }
            }
        },
        401: {
            "description": "Authentication failed",
            "content": {
                "application/json": {
                    "example": {
                        "success": False,
                        "error": {
                            "code": 4001,
                            "message": "Invalid API key"
                        }
                    }
                }
            }
        }
    }
)
async def get_stock(
    code: str = Path(..., regex=r'^\d{6}$', description="6-digit stock code (e.g., 005930)")
):
    """Get detailed stock information."""
    # Implementation
    pass
```

### Swagger UI Customization

**Custom Swagger Configuration:**
```python
from fastapi.openapi.docs import get_swagger_ui_html
from fastapi.staticfiles import StaticFiles

app.mount("/static", StaticFiles(directory="static"), name="static")

@app.get("/docs", include_in_schema=False)
async def custom_swagger_ui_html():
    """Custom Swagger UI with branding."""
    return get_swagger_ui_html(
        openapi_url=app.openapi_url,
        title=f"{app.title} - API Documentation",
        oauth2_redirect_url=app.swagger_ui_oauth2_redirect_url,
        swagger_js_url="/static/swagger-ui-bundle.js",
        swagger_css_url="/static/swagger-ui.css",
        swagger_favicon_url="/static/favicon.ico",
        swagger_ui_parameters={
            "defaultModelsExpandDepth": 1,
            "defaultModelExpandDepth": 1,
            "displayRequestDuration": True,
            "filter": True,
            "showExtensions": True,
            "tryItOutEnabled": True,
            "persistAuthorization": True,
            "displayOperationId": False,
            "docExpansion": "list"
        }
    )
```

**Custom CSS for Branding:**
```css
/* static/swagger-custom.css */
.swagger-ui .topbar {
    background-color: #1a1a2e;
    border-bottom: 3px solid #0f3460;
}

.swagger-ui .topbar .download-url-wrapper {
    display: none;
}

.swagger-ui .info .title {
    color: #16213e;
    font-size: 36px;
}

.swagger-ui .info .description {
    color: #333;
}

.swagger-ui .btn.execute {
    background-color: #0f3460;
    border-color: #0f3460;
}

.swagger-ui .btn.execute:hover {
    background-color: #16213e;
    border-color: #16213e;
}

.swagger-ui .opblock-tag {
    border-bottom: 2px solid #0f3460;
}

.swagger-ui .opblock.opblock-get .opblock-summary-method {
    background: #61affe;
}

.swagger-ui .opblock.opblock-post .opblock-summary-method {
    background: #49cc90;
}
```

### Documentation Portal Structure

**Docusaurus Configuration:**
```javascript
// docusaurus.config.js
module.exports = {
  title: 'TheScreener API Documentation',
  tagline: 'Powerful Korean Stock Market API',
  url: 'https://docs.thescreener.com',
  baseUrl: '/',
  favicon: 'img/favicon.ico',
  organizationName: 'thescreener',
  projectName: 'api-docs',
  themeConfig: {
    navbar: {
      title: 'TheScreener API',
      logo: {
        alt: 'TheScreener Logo',
        src: 'img/logo.svg',
      },
      items: [
        {
          to: 'docs/getting-started',
          label: 'Getting Started',
          position: 'left',
        },
        {
          to: 'docs/api-reference',
          label: 'API Reference',
          position: 'left',
        },
        {
          to: 'docs/guides',
          label: 'Guides',
          position: 'left',
        },
        {
          to: 'docs/sdks',
          label: 'SDKs',
          position: 'left',
        },
        {
          to: 'docs/changelog',
          label: 'Changelog',
          position: 'left',
        },
        {
          href: 'https://api.thescreener.com/docs',
          label: 'Interactive API',
          position: 'right',
        },
        {
          href: 'https://github.com/thescreener',
          label: 'GitHub',
          position: 'right',
        },
      ],
    },
    footer: {
      style: 'dark',
      links: [
        {
          title: 'Documentation',
          items: [
            {
              label: 'Getting Started',
              to: 'docs/getting-started',
            },
            {
              label: 'API Reference',
              to: 'docs/api-reference',
            },
            {
              label: 'Guides',
              to: 'docs/guides',
            },
          ],
        },
        {
          title: 'SDKs',
          items: [
            {
              label: 'Python SDK',
              to: 'docs/sdks/python',
            },
            {
              label: 'JavaScript SDK',
              to: 'docs/sdks/javascript',
            },
          ],
        },
        {
          title: 'Community',
          items: [
            {
              label: 'Discord',
              href: 'https://discord.gg/thescreener',
            },
            {
              label: 'GitHub',
              href: 'https://github.com/thescreener',
            },
            {
              label: 'Support',
              href: 'https://thescreener.com/support',
            },
          ],
        },
      ],
      copyright: `Copyright © ${new Date().getFullYear()} TheScreener. All rights reserved.`,
    },
    algolia: {
      apiKey: 'your-search-api-key',
      indexName: 'thescreener-docs',
      contextualSearch: true,
    },
    prism: {
      theme: require('prism-react-renderer/themes/github'),
      darkTheme: require('prism-react-renderer/themes/dracula'),
      additionalLanguages: ['python', 'javascript', 'bash', 'json'],
    },
  },
  presets: [
    [
      '@docusaurus/preset-classic',
      {
        docs: {
          sidebarPath: require.resolve('./sidebars.js'),
          editUrl: 'https://github.com/thescreener/api-docs/edit/main/',
          showLastUpdateTime: true,
          showLastUpdateAuthor: true,
        },
        theme: {
          customCss: require.resolve('./src/css/custom.css'),
        },
      },
    ],
  ],
  plugins: [
    [
      '@docusaurus/plugin-content-docs',
      {
        id: 'api',
        path: 'api',
        routeBasePath: 'api',
        sidebarPath: require.resolve('./sidebars-api.js'),
      },
    ],
  ],
};
```

### Code Example Templates

**Python Quick Start:**
```markdown
---
id: python-quickstart
title: Python Quick Start
sidebar_label: Quick Start
---

# Python Quick Start

Get started with TheScreener API in Python in less than 5 minutes.

## Installation

Install the official Python SDK using pip:

\`\`\`bash
pip install thescreener
\`\`\`

For async support:

\`\`\`bash
pip install thescreener[async]
\`\`\`

## Authentication

First, get your API key from [your dashboard](https://thescreener.com/settings/api).

\`\`\`python
from thescreener import Client

# Initialize the client
client = Client(api_key="your_api_key_here")
\`\`\`

:::tip
Store your API key in an environment variable instead of hardcoding it:

\`\`\`python
import os
from thescreener import Client

api_key = os.getenv("THESCREENER_API_KEY")
client = Client(api_key=api_key)
\`\`\`
:::

## Your First Request

Let's fetch information about Samsung Electronics (stock code: 005930):

\`\`\`python
# Get stock information
stock = client.stocks.get("005930")

print(f"Name: {stock.name}")
print(f"Price: ₩{stock.current_price:,}")
print(f"Market Cap: ₩{stock.market_cap:,}")
print(f"PER: {stock.per}")
\`\`\`

**Output:**
\`\`\`
Name: Samsung Electronics
Price: ₩75,000
Market Cap: ₩500,000,000,000,000
PER: 12.5
\`\`\`

## Screening Stocks

Find stocks matching your criteria:

\`\`\`python
# Screen for value stocks
results = client.screen(
    filters=[
        {"field": "per", "operator": "lt", "value": 10},
        {"field": "roe", "operator": "gt", "value": 15},
        {"field": "market", "operator": "eq", "value": "KOSPI"}
    ],
    sort_by="market_cap",
    order="desc",
    limit=20
)

print(f"Found {len(results)} stocks:")
for stock in results:
    print(f"  {stock.code} - {stock.name}: ₩{stock.current_price:,}")
\`\`\`

## Error Handling

Always handle potential errors:

\`\`\`python
from thescreener import Client, ScreenerError, RateLimitError

client = Client(api_key="your_api_key")

try:
    stock = client.stocks.get("005930")
except RateLimitError as e:
    print(f"Rate limit exceeded. Retry after {e.retry_after} seconds")
except ScreenerError as e:
    print(f"API error: {e.message}")
\`\`\`

## Next Steps

- [Complete Python SDK documentation](/docs/sdks/python)
- [Advanced screening techniques](/docs/guides/screening)
- [Webhook integration](/docs/guides/webhooks)
- [Example applications](https://github.com/thescreener/examples)
```

**JavaScript Quick Start:**
```markdown
---
id: javascript-quickstart
title: JavaScript Quick Start
sidebar_label: Quick Start
---

# JavaScript Quick Start

Get started with TheScreener API in JavaScript/TypeScript.

## Installation

Install using npm or yarn:

\`\`\`bash
npm install @thescreener/sdk
# or
yarn add @thescreener/sdk
\`\`\`

## Basic Usage

\`\`\`javascript
import { ScreenerClient } from '@thescreener/sdk';

// Initialize the client
const client = new ScreenerClient({
  apiKey: process.env.THESCREENER_API_KEY
});

// Get stock information
const stock = await client.stocks.get('005930');

console.log(\`Name: \${stock.name}\`);
console.log(\`Price: ₩\${stock.currentPrice.toLocaleString()}\`);
console.log(\`PER: \${stock.per}\`);
\`\`\`

## TypeScript Support

Full TypeScript support with type definitions:

\`\`\`typescript
import { ScreenerClient, Stock, ScreenFilter } from '@thescreener/sdk';

const client = new ScreenerClient({
  apiKey: process.env.THESCREENER_API_KEY!
});

// Type-safe stock data
const stock: Stock = await client.stocks.get('005930');

// Type-safe screening
const filters: ScreenFilter[] = [
  { field: 'per', operator: 'lt', value: 10 },
  { field: 'roe', operator: 'gt', value: 15 }
];

const results = await client.screen({ filters, limit: 20 });
\`\`\`

## React Integration

Use with React hooks:

\`\`\`typescript
import { useState, useEffect } from 'react';
import { ScreenerClient } from '@thescreener/sdk';

function StockPrice({ code }: { code: string }) {
  const [stock, setStock] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const client = new ScreenerClient({
      apiKey: process.env.REACT_APP_API_KEY
    });

    client.stocks.get(code)
      .then(setStock)
      .catch(console.error)
      .finally(() => setLoading(false));
  }, [code]);

  if (loading) return <div>Loading...</div>;
  if (!stock) return <div>Stock not found</div>;

  return (
    <div>
      <h2>{stock.name}</h2>
      <p>Price: ₩{stock.currentPrice.toLocaleString()}</p>
    </div>
  );
}
\`\`\`

## Error Handling

\`\`\`javascript
import { ScreenerClient, ScreenerError } from '@thescreener/sdk';

const client = new ScreenerClient({ apiKey: 'your-api-key' });

try {
  const stock = await client.stocks.get('005930');
} catch (error) {
  if (error instanceof ScreenerError) {
    console.error(\`API Error [\${error.code}]: \${error.message}\`);

    if (error.code === 4290) {
      console.log(\`Rate limited. Retry after \${error.retryAfter}s\`);
    }
  } else {
    console.error('Unexpected error:', error);
  }
}
\`\`\`

## Next Steps

- [Complete JavaScript SDK documentation](/docs/sdks/javascript)
- [React hooks guide](/docs/guides/react-hooks)
- [Browser vs Node.js usage](/docs/guides/environments)
```

## Testing Strategy

### Documentation Quality Tests

```python
import pytest
from bs4 import BeautifulSoup
import requests

class TestDocumentation:
    """Test documentation portal quality and accessibility."""

    def test_all_pages_load(self):
        """Verify all documentation pages load successfully."""
        pages = [
            "/docs/getting-started",
            "/docs/api-reference",
            "/docs/authentication",
            "/docs/rate-limits",
            "/docs/sdks/python",
            "/docs/sdks/javascript",
            "/docs/changelog"
        ]

        for page in pages:
            response = requests.get(f"https://docs.thescreener.com{page}")
            assert response.status_code == 200, f"Page {page} failed to load"

    def test_code_examples_syntax(self):
        """Verify all code examples have valid syntax."""
        # Test Python examples
        python_examples = get_all_code_blocks("python")
        for example in python_examples:
            try:
                compile(example, '<string>', 'exec')
            except SyntaxError as e:
                pytest.fail(f"Invalid Python syntax: {e}")

    def test_api_reference_completeness(self):
        """Verify API reference documents all endpoints."""
        openapi_spec = requests.get("https://api.thescreener.com/openapi.json").json()
        docs_page = requests.get("https://docs.thescreener.com/docs/api-reference").text

        for path in openapi_spec["paths"]:
            assert path in docs_page, f"Endpoint {path} not documented"

    def test_broken_links(self):
        """Check for broken internal and external links."""
        response = requests.get("https://docs.thescreener.com")
        soup = BeautifulSoup(response.content, 'html.parser')

        for link in soup.find_all('a'):
            href = link.get('href')
            if href and href.startswith('http'):
                link_response = requests.head(href, allow_redirects=True)
                assert link_response.status_code < 400, f"Broken link: {href}"

    def test_search_functionality(self):
        """Test documentation search returns relevant results."""
        # Algolia search test
        search_results = search_docs("authentication")
        assert len(search_results) > 0
        assert any("authentication" in r["title"].lower() for r in search_results)
```

### Interactive API Tester Tests

```python
class TestSwaggerUI:
    """Test Swagger UI interactive tester functionality."""

    def test_swagger_ui_loads(self):
        """Verify Swagger UI page loads correctly."""
        response = requests.get("https://api.thescreener.com/docs")
        assert response.status_code == 200
        assert "swagger-ui" in response.text

    def test_openapi_spec_valid(self):
        """Verify OpenAPI specification is valid."""
        spec = requests.get("https://api.thescreener.com/openapi.json").json()

        assert "openapi" in spec
        assert spec["openapi"].startswith("3.0")
        assert "paths" in spec
        assert "components" in spec

    def test_try_it_out_works(self, test_api_key):
        """Test the 'Try it out' feature with authentication."""
        # This would be an E2E test with Selenium/Playwright
        pass
```

### End-to-End Documentation Tests

```python
class TestE2EDocumentation:
    """End-to-end tests following documentation examples."""

    def test_python_quickstart_example(self):
        """Follow Python quickstart guide step-by-step."""
        # Execute code from quickstart guide
        from thescreener import Client

        client = Client(api_key=os.getenv("TEST_API_KEY"))
        stock = client.stocks.get("005930")

        assert stock.name == "Samsung Electronics"
        assert stock.current_price > 0

    def test_javascript_quickstart_example(self):
        """Verify JavaScript example code is valid."""
        # Would use Node.js to execute example
        pass

    def test_curl_examples_work(self):
        """Test all cURL examples from documentation."""
        # Execute cURL commands from docs
        result = subprocess.run([
            "curl",
            "-H", "X-API-Key: test_key",
            "https://api.thescreener.com/api/v1/public/stocks/005930"
        ], capture_output=True, text=True)

        assert result.returncode == 0
        data = json.loads(result.stdout)
        assert data["success"] is True
```

## Risk Assessment

| Risk | Probability | Impact | Mitigation Strategy | Owner |
|------|-------------|--------|---------------------|-------|
| Documentation becomes outdated | High | High | Auto-generate from code, add CI checks, version docs with API | Tech Writing Team |
| Code examples contain errors | Medium | High | Automated testing of all examples, CI/CD validation | QA Team |
| Poor search functionality | Medium | Medium | Implement Algolia, add synonyms, optimize indexing | Frontend Team |
| Broken external links | Medium | Low | Regular link checking, automated monitoring | DevOps Team |
| Inconsistent terminology | Medium | Medium | Style guide, glossary, peer review process | Tech Writing Team |
| Missing error code documentation | Low | Medium | Generate from code, comprehensive error catalog | Backend Team |
| Slow page load times | Low | Medium | CDN deployment, image optimization, lazy loading | Frontend Team |
| Accessibility issues | Medium | Low | A11y testing, WCAG 2.1 compliance, screen reader testing | Frontend Team |

## Performance Requirements

### Portal Performance

| Metric | Target | Max |
|--------|--------|-----|
| Page Load Time | < 1s | 2s |
| Time to Interactive | < 2s | 3s |
| First Contentful Paint | < 0.5s | 1s |
| Search Response Time | < 200ms | 500ms |
| Lighthouse Score | > 90 | 80 |

### Infrastructure

- **CDN**: CloudFront/Cloudflare for global distribution
- **Caching**: 1-hour cache for static content
- **Image Optimization**: WebP format, lazy loading
- **Code Splitting**: Route-based code splitting
- **Analytics**: Google Analytics + custom tracking

## Security Considerations

### API Key Protection in Examples

```markdown
## Security Best Practices

:::danger Never commit API keys
Do not commit API keys to version control. Always use environment variables.

**Bad:**
\`\`\`python
client = Client(api_key="sk_live_abc123")  # ❌ Never do this
\`\`\`

**Good:**
\`\`\`python
import os
client = Client(api_key=os.getenv("THESCREENER_API_KEY"))  # ✅ Correct
\`\`\`
:::
```

### Secure Example Code

```python
# All code examples must follow security best practices

# ❌ Bad Example
api_key = "sk_live_abc123"
client = Client(api_key=api_key)

# ✅ Good Example
import os
from dotenv import load_dotenv

load_dotenv()
api_key = os.getenv("THESCREENER_API_KEY")

if not api_key:
    raise ValueError("API key not found. Set THESCREENER_API_KEY environment variable.")

client = Client(api_key=api_key)
```

### HTTPS Enforcement

```markdown
## HTTPS Requirement

All API requests **must** use HTTPS. HTTP requests will be rejected.

\`\`\`bash
# ✅ Correct
curl https://api.thescreener.com/api/v1/public/stocks

# ❌ Will fail
curl http://api.thescreener.com/api/v1/public/stocks
\`\`\`
```

## Error Handling

### Documentation Build Errors

```yaml
# .github/workflows/docs-build.yml
name: Documentation Build

on:
  push:
    branches: [main]
  pull_request:
    paths:
      - 'docs/**'
      - 'docusaurus.config.js'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
      - run: npm ci
      - run: npm run build
      - name: Check for broken links
        run: npm run check-links
      - name: Validate code examples
        run: npm run validate-examples
      - name: Deploy to Netlify
        if: github.ref == 'refs/heads/main'
        run: netlify deploy --prod
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_TOKEN }}
```

### Example Validation Script

```javascript
// scripts/validate-examples.js
const fs = require('fs');
const path = require('path');
const { exec } = require('child_process');

function findCodeBlocks(content, language) {
  const regex = new RegExp(`\`\`\`${language}\\n([\\s\\S]*?)\`\`\``, 'g');
  const blocks = [];
  let match;

  while ((match = regex.exec(content)) !== null) {
    blocks.push(match[1]);
  }

  return blocks;
}

function validatePythonCode(code) {
  return new Promise((resolve, reject) => {
    const tempFile = path.join(__dirname, 'temp.py');
    fs.writeFileSync(tempFile, code);

    exec(`python -m py_compile ${tempFile}`, (error) => {
      fs.unlinkSync(tempFile);

      if (error) {
        reject(new Error(`Python syntax error: ${error.message}`));
      } else {
        resolve();
      }
    });
  });
}

async function main() {
  const docsDir = path.join(__dirname, '..', 'docs');
  const files = getAllMarkdownFiles(docsDir);

  let hasErrors = false;

  for (const file of files) {
    const content = fs.readFileSync(file, 'utf-8');
    const pythonBlocks = findCodeBlocks(content, 'python');

    for (let i = 0; i < pythonBlocks.length; i++) {
      try {
        await validatePythonCode(pythonBlocks[i]);
        console.log(`✅ ${file} - Python block ${i + 1} valid`);
      } catch (error) {
        console.error(`❌ ${file} - Python block ${i + 1} invalid:`);
        console.error(error.message);
        hasErrors = true;
      }
    }
  }

  if (hasErrors) {
    process.exit(1);
  }
}

main();
```

## Acceptance Criteria

- [x] OpenAPI 3.0 specification auto-generated from code
- [x] Swagger UI integrated with custom branding
- [x] Interactive API tester with authentication
- [x] Getting Started guide with step-by-step instructions
- [x] Python code examples for all major features
- [x] JavaScript/TypeScript code examples
- [x] cURL examples for all endpoints
- [x] Authentication guide with best practices
- [x] Rate limiting documentation with examples
- [x] Changelog with version history
- [x] Search functionality (Algolia)
- [x] Responsive design for mobile/tablet
- [x] Accessibility (WCAG 2.1 AA compliant)
- [x] Analytics tracking
- [x] CDN deployment
- [x] Automated testing of code examples
- [x] Broken link checking

## Dependencies

- **Requires**: API-002 (Public API Endpoints)
- **Blocks**: None (documentation supports SDK development but doesn't block it)

## Progress

**0% - Not started**

- [ ] OpenAPI/Swagger Setup (0/3)
- [ ] Interactive API Tester (0/3)
- [ ] Getting Started Guide (0/3)
- [ ] Code Examples & Samples (0/3)
- [ ] Authentication Guide (0/3)
- [ ] Rate Limiting Documentation (0/3)
- [ ] Changelog & Migration Guides (0/3)
- [ ] Portal Infrastructure (0/3)

## Notes

### Documentation Framework Comparison

| Framework | Pros | Cons | Recommendation |
|-----------|------|------|----------------|
| **Docusaurus** | React-based, great search, versioning | Requires build step | ✅ Recommended |
| **MkDocs** | Simple, Python-based, fast | Less interactive | Good for simple docs |
| **Sphinx** | Python standard, powerful | Steep learning curve | For API reference only |
| **VuePress** | Vue-based, fast, simple | Smaller ecosystem | Alternative option |

### Content Strategy

1. **Progressive Disclosure**: Start with simple examples, link to advanced guides
2. **Task-Oriented**: Organize by what users want to accomplish
3. **Visual Examples**: Use diagrams, screenshots, and videos
4. **Copy-Paste Ready**: All code examples should be immediately usable
5. **Keep Updated**: Auto-generate where possible, regular reviews

### Metrics to Track

- Page views per documentation section
- Search queries (identify gaps)
- Time on page (engagement)
- Bounce rate (content quality)
- API adoption rate (effectiveness)
- Support ticket reduction (completeness)

### Future Enhancements

- Video tutorials
- Interactive playground (CodeSandbox integration)
- Community-contributed examples
- GraphQL documentation (when available)
- Localization (Korean, Japanese)
- API changelog notifications
- Documentation chatbot
- Community forum integration

### Related Resources

- [Stripe API Documentation](https://stripe.com/docs/api) - Best practice example
- [Twilio Docs](https://www.twilio.com/docs) - Great code examples
- [GitHub REST API Docs](https://docs.github.com/en/rest) - Comprehensive reference
- [Google Developers Style Guide](https://developers.google.com/style) - Writing guidelines

---

**Last Updated**: 2025-11-30
**Status**: Ready for implementation
