# MOB-001: Mobile Project Setup (Expo)

## Metadata

| Field | Value |
|-------|-------|
| **ID** | MOB-001 |
| **Title** | Initialize React Native Project with Expo |
| **Type** | Infrastructure |
| **Status** | BACKLOG |
| **Priority** | P0 (Critical) |
| **Estimate** | 8 hours |
| **Sprint** | Sprint 5 |
| **Epic** | Mobile Application |
| **Assignee** | TBD |
| **Blocks** | MOB-002, MOB-003, MOB-004, MOB-005, MOB-006 |
| **Created** | 2025-11-29 |
| **Tags** | #mobile #infrastructure #setup #expo #react-native |

## Description

Set up the foundational Expo-based React Native project structure with TypeScript support, establish a monorepo pattern for code sharing with the existing web application, and configure CI/CD pipelines using EAS Build for automated builds and deployments.

## Subtasks

### Project Initialization
- [ ] Initialize Expo managed workflow project with TypeScript template
  - [ ] Run `npx create-expo-app@latest mobile --template expo-template-blank-typescript`
  - [ ] Configure app.json with app name, slug, and bundle identifier
  - [ ] Set up iOS bundle ID: `com.screener.mobile`
  - [ ] Set up Android package: `com.screener.mobile`
- [ ] Configure TypeScript
  - [ ] Update tsconfig.json with strict mode enabled
  - [ ] Add path aliases for cleaner imports (`@components`, `@hooks`, etc.)
  - [ ] Configure baseUrl and paths

### Monorepo Structure Setup
- [ ] Set up shared package structure
  - [ ] Create `packages/shared` directory for common code
  - [ ] Configure yarn workspaces or npm workspaces
  - [ ] Move reusable hooks to shared package
  - [ ] Move API service layer to shared package
  - [ ] Move Zustand stores to shared package
  - [ ] Move TypeScript types/interfaces to shared package
- [ ] Configure build tools for monorepo
  - [ ] Set up Turborepo or Nx for build orchestration
  - [ ] Configure package dependencies

### Environment Configuration
- [ ] Set up environment-specific configurations
  - [ ] Create `.env.development` file
  - [ ] Create `.env.staging` file
  - [ ] Create `.env.production` file
  - [ ] Configure `expo-constants` for runtime config access
- [ ] Define environment variables
  - [ ] `API_BASE_URL` - Backend API endpoint
  - [ ] `WS_BASE_URL` - WebSocket endpoint for real-time updates
  - [ ] `SENTRY_DSN` - Error tracking (production)
  - [ ] `ANALYTICS_KEY` - Analytics integration

### CI/CD Pipeline (EAS Build)
- [ ] Configure EAS Build
  - [ ] Create `eas.json` configuration file
  - [ ] Set up development profile (internal distribution)
  - [ ] Set up staging profile (TestFlight/Internal Testing)
  - [ ] Set up production profile (App Store/Play Store)
- [ ] Set up GitHub Actions workflow
  - [ ] Create `.github/workflows/mobile-build.yml`
  - [ ] Configure automatic builds on PR merge
  - [ ] Set up staging deployment on main branch
  - [ ] Add build status badges to README

### Essential Dependencies Installation
- [ ] Install core dependencies
  - [ ] `expo-router` - File-based routing
  - [ ] `react-native-reanimated` - Animations
  - [ ] `react-native-gesture-handler` - Gestures
  - [ ] `@react-native-async-storage/async-storage` - Local storage
  - [ ] `axios` - HTTP client
  - [ ] `zustand` - State management
  - [ ] `react-query` - Server state management
- [ ] Install development dependencies
  - [ ] `jest` and `@testing-library/react-native` - Testing
  - [ ] `eslint` and `prettier` - Code quality
  - [ ] `@types/react-native` - TypeScript types

## Project Structure

```
mobile/
├── app/                        # Expo Router screens
│   ├── (auth)/                 # Auth group
│   │   ├── login.tsx
│   │   └── register.tsx
│   ├── (tabs)/                 # Main tab navigator
│   │   ├── index.tsx           # Home
│   │   ├── screener.tsx        # Screener
│   │   ├── portfolio.tsx       # Portfolio
│   │   ├── alerts.tsx          # Alerts
│   │   └── settings.tsx        # Settings
│   ├── stock/[code].tsx        # Stock detail (dynamic route)
│   └── _layout.tsx             # Root layout
├── src/
│   ├── components/             # React Native components
│   │   ├── common/             # Shared UI components
│   │   ├── charts/             # Chart components
│   │   └── forms/              # Form components
│   ├── hooks/                  # Custom hooks (extend shared)
│   ├── services/               # API services (extend shared)
│   ├── store/                  # Zustand stores (extend shared)
│   ├── utils/                  # Utilities
│   └── constants/              # App constants
├── assets/                     # Static assets
│   ├── images/
│   ├── fonts/
│   └── icons/
├── app.json                    # Expo configuration
├── eas.json                    # EAS Build configuration
├── package.json
├── tsconfig.json
└── babel.config.js

packages/
├── shared/
│   ├── src/
│   │   ├── api/               # API client and endpoints
│   │   ├── hooks/             # Shared React hooks
│   │   ├── store/             # Zustand store definitions
│   │   ├── types/             # TypeScript interfaces
│   │   └── utils/             # Shared utilities
│   ├── package.json
│   └── tsconfig.json
```

## Implementation Details

### app.json Configuration
```json
{
  "expo": {
    "name": "Stock Screener",
    "slug": "stock-screener",
    "version": "1.0.0",
    "orientation": "portrait",
    "icon": "./assets/icon.png",
    "userInterfaceStyle": "automatic",
    "splash": {
      "image": "./assets/splash.png",
      "resizeMode": "contain",
      "backgroundColor": "#ffffff"
    },
    "ios": {
      "bundleIdentifier": "com.screener.mobile",
      "supportsTablet": true,
      "infoPlist": {
        "NSCameraUsageDescription": "Used for QR code scanning",
        "NSPhotoLibraryUsageDescription": "Used for uploading profile photos"
      }
    },
    "android": {
      "package": "com.screener.mobile",
      "adaptiveIcon": {
        "foregroundImage": "./assets/adaptive-icon.png",
        "backgroundColor": "#ffffff"
      },
      "permissions": ["CAMERA", "READ_EXTERNAL_STORAGE"]
    },
    "plugins": [
      "expo-router",
      "expo-secure-store",
      [
        "expo-build-properties",
        {
          "ios": { "deploymentTarget": "13.0" },
          "android": { "minSdkVersion": 24 }
        }
      ]
    ]
  }
}
```

### eas.json Configuration
```json
{
  "cli": {
    "version": ">= 5.0.0"
  },
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal",
      "ios": {
        "simulator": true
      }
    },
    "staging": {
      "distribution": "internal",
      "env": {
        "APP_ENV": "staging"
      }
    },
    "production": {
      "env": {
        "APP_ENV": "production"
      }
    }
  },
  "submit": {
    "production": {
      "ios": {
        "appleId": "developer@screener.com",
        "ascAppId": "1234567890"
      },
      "android": {
        "serviceAccountKeyPath": "./play-store-key.json"
      }
    }
  }
}
```

### GitHub Actions Workflow
```yaml
# .github/workflows/mobile-build.yml
name: Mobile Build

on:
  push:
    branches: [main]
    paths:
      - 'mobile/**'
      - 'packages/shared/**'
  pull_request:
    branches: [main]
    paths:
      - 'mobile/**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'yarn'

      - name: Install dependencies
        run: yarn install --frozen-lockfile

      - name: Run tests
        run: yarn test:mobile

      - name: Build (Staging)
        if: github.ref == 'refs/heads/main'
        run: |
          cd mobile
          npx eas-cli build --platform all --profile staging --non-interactive
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
```

## Acceptance Criteria

- [ ] `expo start` runs successfully without errors
- [ ] TypeScript compilation passes with no errors
- [ ] Path aliases resolve correctly (`@components/Button` works)
- [ ] Shared package imports work (`import { useAuth } from '@shared/hooks'`)
- [ ] Environment variables load correctly per environment
- [ ] EAS Build completes successfully for:
  - [ ] iOS simulator build
  - [ ] Android development build
  - [ ] iOS staging build (TestFlight)
  - [ ] Android staging build (Internal Testing)
- [ ] GitHub Actions workflow passes
- [ ] Jest test suite runs successfully
- [ ] ESLint/Prettier checks pass

## Testing Strategy

### Unit Tests
- [ ] Test shared package imports resolve correctly
- [ ] Test environment variable loading
- [ ] Test TypeScript path alias resolution

### Integration Tests
- [ ] Test EAS Build pipeline end-to-end
- [ ] Test GitHub Actions workflow triggers
- [ ] Test monorepo workspace dependencies

### Manual Testing
- [ ] Verify iOS simulator runs on macOS
- [ ] Verify Android emulator runs
- [ ] Verify hot reload works
- [ ] Verify Metro bundler performance

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Expo SDK compatibility issues | Medium | High | Pin Expo SDK version, test upgrades in staging |
| Monorepo complexity | Medium | Medium | Use proven tools (Turborepo), document setup |
| EAS Build quota limits | Low | Medium | Monitor build usage, optimize build triggers |
| Code sharing conflicts | Medium | Medium | Clear API boundaries, versioned shared package |

## Performance Requirements

- Metro bundler startup: < 30 seconds
- Hot reload time: < 2 seconds
- Initial app bundle size: < 20 MB
- Build time (CI): < 15 minutes

## Security Considerations

- [ ] Never commit `.env` files to repository
- [ ] Use `expo-secure-store` for sensitive data
- [ ] Configure proper iOS/Android signing keys
- [ ] Protect EAS Build credentials
- [ ] Set up Sentry for error tracking without exposing sensitive data

## Error Handling

- Configure global error boundary for React components
- Set up crash reporting (Sentry/Crashlytics)
- Implement graceful fallbacks for shared package import failures

## Dependencies

- **External**: Node.js 18+, Expo CLI, EAS CLI
- **Internal**: Existing web app hooks, stores, and API services
- **Blocks**: MOB-002, MOB-003, MOB-004, MOB-005, MOB-006

## References

- **SDS.md**: Section 4.1 Mobile Architecture
- [Expo Documentation](https://docs.expo.dev/)
- [Expo Router](https://docs.expo.dev/router/introduction/)
- [EAS Build](https://docs.expo.dev/build/introduction/)
- [Turborepo](https://turbo.build/repo/docs)
- [IMPROVEMENT_TICKETS.md](../../IMPROVEMENT_TICKETS.md) - Epic 3: Mobile Application

## Progress

- **0%** - Not started

## Notes

- Use Expo SDK 50+ for latest features and security patches
- Consider using `expo-dev-client` for custom native modules if needed
- Keep shared package API surface minimal to reduce coupling
- Document any platform-specific code with clear comments
- Test on both iOS and Android from the beginning to catch platform issues early
