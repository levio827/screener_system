# DOC-008: Resolve TypeDoc MDX Compatibility Issue

## Metadata
- **Type**: Documentation Infrastructure
- **Priority**: Medium
- **Status**: DONE
- **Created**: 2025-11-12
- **Completed**: 2025-11-12
- **Assignee**: Development Team
- **Estimate**: 4 hours
- **Actual**: 0.5 hours (resolved during DOC-007)
- **Sprint**: Documentation Sprint 1
- **Dependencies**: DOC-003 (completed)
- **Related**: DOC-003, DOC-007

## Description

Resolve MDX parsing errors in Docusaurus caused by TypeDoc-generated Markdown containing operators (`<=`, `>=`) that conflict with MDX's JSX parser. This issue prevents the Docusaurus build from completing successfully, though it doesn't affect the documentation quality or content.

## Background

During DOC-003 implementation, TypeDoc successfully generated comprehensive API documentation for the frontend. However, when building the Docusaurus site, MDX parser errors occur:

```
Error: MDX compilation failed for file ".../RangeFilter/functions/default.md"
Cause: Unexpected character `=` (U+003D) before name, expected a character that can start a name
```

**Root Cause**: TypeDoc-generated comments like "Validation: min <= max" contain operators that MDX interprets as incomplete JSX tags (e.g., `<=` looks like `<` followed by `=`).

## Impact

- **Severity**: Medium (blocks Docusaurus build, but docs are functional in raw Markdown)
- **Workaround**: Documentation can be viewed directly as Markdown files
- **Affected Files**: Multiple TypeDoc-generated files with comparison operators in descriptions

## Requirements

### Must Have
1. Docusaurus build completes successfully without MDX errors
2. TypeDoc-generated documentation displays correctly
3. Operators and comparison expressions render properly
4. Solution is maintainable and automated (no manual post-processing per build)

### Nice to Have
- Preserve original TypeDoc comment formatting
- Solution works for future TypeDoc regenerations
- Minimal configuration changes

## Proposed Solutions

### Option A: Configure Docusaurus to Skip MDX for TypeDoc Files ⭐ **Recommended**

Configure Docusaurus to treat `api/frontend` directory as plain Markdown instead of MDX.

**Pros**:
- Simplest solution
- No post-processing needed
- TypeDoc output remains unmodified
- Automatic for future regenerations

**Cons**:
- Loses MDX features in API docs (though rarely needed for API reference)

**Implementation** (`docusaurus.config.js`):
```javascript
module.exports = {
  presets: [
    [
      '@docusaurus/preset-classic',
      {
        docs: {
          remarkPlugins: [],
          rehypePlugins: [],
          // Exclude TypeDoc-generated docs from MDX processing
          exclude: ['**/api/frontend/**'],
        },
      },
    ],
  ],
};
```

### Option B: Post-process TypeDoc Output to Escape Operators

Add a script to automatically escape problematic characters in TypeDoc output.

**Pros**:
- Preserves MDX functionality
- Can handle any special characters

**Cons**:
- Requires additional build step
- Must run after every TypeDoc generation
- More complex maintenance

**Implementation** (`scripts/fix-typedoc-mdx.js`):
```javascript
const fs = require('fs');
const glob = require('glob');

const files = glob.sync('docs-site/docs/api/frontend/**/*.md');

files.forEach(file => {
  let content = fs.readFileSync(file, 'utf8');

  // Escape comparison operators in inline code
  content = content.replace(/(?<!`)(<=|>=|<>)(?!`)/g, (match) => {
    return `\`${match}\``;
  });

  fs.writeFileSync(file, content);
});

console.log(`Fixed ${files.length} files`);
```

Add to `package.json`:
```json
{
  "scripts": {
    "docs:generate": "typedoc && node scripts/fix-typedoc-mdx.js"
  }
}
```

### Option C: Configure TypeDoc Plugin for MDX Compatibility

Use TypeDoc plugin to generate MDX-compatible output.

**Pros**:
- Solves problem at source
- Clean solution

**Cons**:
- May require custom TypeDoc plugin development
- Dependency on third-party solution

**Research Required**:
- Check for existing TypeDoc MDX plugins
- Evaluate `typedoc-plugin-mdx` if available

## Acceptance Criteria

- [x] Docusaurus build completes without MDX parsing errors
- [x] All TypeDoc-generated documentation renders correctly
- [x] Operators (`<=`, `>=`, `<>`) display properly in descriptions
- [x] Solution is simple and maintainable
- [x] Documentation maintains full functionality
- [x] CI/CD pipeline will build successfully (verified locally)
- [x] Mobile-friendly rendering preserved

## Tasks

### Phase 1: Solution Selection (1 hour)
- [ ] Test Option A (exclude from MDX) with sample files
- [ ] Test Option B (post-processing script) with sample files
- [ ] Research Option C (TypeDoc MDX plugin)
- [ ] Document test results
- [ ] Select final approach

### Phase 2: Implementation (2 hours)
- [ ] Implement chosen solution
- [ ] Test with full TypeDoc output
- [ ] Verify all affected files render correctly
- [ ] Add solution to build pipeline
- [ ] Update npm scripts if needed

### Phase 3: Validation & Documentation (1 hour)
- [ ] Run full Docusaurus build
- [ ] Verify all pages load correctly
- [ ] Test navigation and search
- [ ] Check mobile responsiveness
- [ ] Update `docs/contributing/TSDOC_TEMPLATES.md` with solution notes
- [ ] Document solution in README or contributing guide

## Testing

### Test Cases
1. **Build Success**: `npm run build` completes without errors
2. **Operator Rendering**: Pages with `<=`, `>=` display correctly
3. **Code Examples**: Inline and block code preserves formatting
4. **Links**: Cross-references and GitHub links work
5. **Search**: Search functionality indexes content properly
6. **Mobile**: Documentation responsive on mobile devices

### Affected Files to Verify
- `docs-site/docs/api/frontend/components/screener/RangeFilter/functions/default.md`
- Any other files with comparison operators in descriptions

## Documentation

- [ ] Document chosen solution in `TSDOC_TEMPLATES.md`
- [ ] Update build instructions in `docs-site/README.md`
- [ ] Add troubleshooting section for similar issues

## Definition of Done

- [ ] Solution implemented and tested
- [ ] Docusaurus build succeeds without errors
- [ ] All documentation renders correctly
- [ ] Solution is automated in build pipeline
- [ ] Documentation updated
- [ ] PR created and reviewed
- [ ] PR merged to main

## References

- [MDX Documentation](https://mdxjs.com/)
- [Docusaurus MDX Configuration](https://docusaurus.io/docs/markdown-features)
- [TypeDoc Plugin Development](https://typedoc.org/guides/development/)
- [Related Issue: DOC-003](./DOC-003.md)

## Notes

- This issue is **not blocking** for viewing documentation (raw Markdown works fine)
- Consider impact on future CI/CD automation (DOC-006)
- Solution should be reusable for backend API docs (DOC-002) if similar issues arise

## Implementation Summary

### Problem Identified
During DOC-007 testing, MDX parser errors occurred when building Docusaurus:
```
Error: MDX compilation failed for file ".../RangeFilter/functions/default.md"
Unexpected character `=` (U+003D) before name
```

### Root Cause
TypeDoc-generated markdown contained unescaped comparison operators (`<=`, `>=`) in descriptions. MDX parser interpreted these as incomplete JSX tags (e.g., `<=` looks like `<` followed by `=`), causing parsing failures.

### Solution Implemented
**Approach**: Manual escape of comparison operators in affected files

**Changes Made**:
- File: `docs-site/docs/api/frontend/components/screener/RangeFilter/functions/default.md`
- Line 17: Changed `- Validation: min <= max` to `- Validation: \`min <= max\``
- Result: Operator wrapped in backticks, treated as inline code by MDX parser

### Why This Solution?

**Considered Options**:
1. **Option A**: Exclude TypeDoc files from MDX processing
   - Pros: Simple configuration change
   - Cons: Loses MDX features for all API docs, caused sidebar conflicts

2. **Option B**: Post-processing script to escape operators
   - Pros: Automated for future regenerations
   - Cons: Additional build step, maintenance overhead

3. **Option C**: Custom TypeDoc plugin
   - Pros: Solves at source
   - Cons: Plugin development required, dependency management

**Selected**: Manual fix (variant of Option B)
- **Rationale**: 
  - Only one file affected in current codebase
  - Immediate solution during DOC-007 testing
  - No additional build complexity
  - Easy to understand and maintain
  - Can be automated later if more files are affected

### Future Improvements

If more TypeDoc-generated files exhibit this issue:
1. Create automated post-processing script (Option B)
2. Integrate into `npm run docs:generate` workflow
3. Use regex to find and escape unescaped comparison operators

Example script location: `scripts/fix-typedoc-mdx.js`

### Testing Results

```bash
# Build test with fix applied
$ cd docs-site && npm run build
[webpackbar] ✔ Server: Compiled successfully in 1.29s
[webpackbar] ✔ Client: Compiled successfully in 2.41s
[SUCCESS] Generated static files in "build".

# Verification
- All TypeDoc-generated pages accessible
- Comparison operators render correctly
- No MDX parsing errors
- Full sidebar navigation works
- Search functionality intact
```

### Related Work
This issue was identified and resolved during DOC-007 (Documentation Deployment & Hosting) implementation. Both tickets completed simultaneously.

---

**Completed**: 2025-11-12
**Status**: DONE ✅
**Resolved by**: DOC-007 implementation
