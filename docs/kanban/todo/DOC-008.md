# DOC-008: Resolve TypeDoc MDX Compatibility Issue

## Metadata
- **Type**: Documentation Infrastructure
- **Priority**: Medium
- **Status**: TODO
- **Created**: 2025-11-12
- **Assignee**: TBD
- **Estimate**: 4 hours
- **Sprint**: Documentation Sprint 1
- **Dependencies**: DOC-003 (completed)
- **Related**: DOC-003

## Description

Resolve MDX parsing errors in Docusaurus caused by TypeDoc-generated Markdown containing operators (`<=`, `>=`) that conflict with MDX's JSX parser. This issue prevents the Docusaurus build from completing successfully, though it doesn't affect the documentation quality or content.

## Background

During DOC-003 implementation, TypeDoc successfully generated comprehensive API documentation for the frontend. However, when building the Docusaurus site, MDX parser errors occur:

```
Error: MDX compilation failed for file ".../RangeFilter/functions/default.md"
Cause: Unexpected character `=` (U+003D) before name, expected a character that can start a name
```

**Root Cause**: TypeDoc-generated comments like "Validation: min <= max" contain operators that MDX interprets as incomplete JSX tags (e.g., `<=` looks like `<` followed by `=`).

## Impact

- **Severity**: Medium (blocks Docusaurus build, but docs are functional in raw Markdown)
- **Workaround**: Documentation can be viewed directly as Markdown files
- **Affected Files**: Multiple TypeDoc-generated files with comparison operators in descriptions

## Requirements

### Must Have
1. Docusaurus build completes successfully without MDX errors
2. TypeDoc-generated documentation displays correctly
3. Operators and comparison expressions render properly
4. Solution is maintainable and automated (no manual post-processing per build)

### Nice to Have
- Preserve original TypeDoc comment formatting
- Solution works for future TypeDoc regenerations
- Minimal configuration changes

## Proposed Solutions

### Option A: Configure Docusaurus to Skip MDX for TypeDoc Files â­ **Recommended**

Configure Docusaurus to treat `api/frontend` directory as plain Markdown instead of MDX.

**Pros**:
- Simplest solution
- No post-processing needed
- TypeDoc output remains unmodified
- Automatic for future regenerations

**Cons**:
- Loses MDX features in API docs (though rarely needed for API reference)

**Implementation** (`docusaurus.config.js`):
```javascript
module.exports = {
  presets: [
    [
      '@docusaurus/preset-classic',
      {
        docs: {
          remarkPlugins: [],
          rehypePlugins: [],
          // Exclude TypeDoc-generated docs from MDX processing
          exclude: ['**/api/frontend/**'],
        },
      },
    ],
  ],
};
```

### Option B: Post-process TypeDoc Output to Escape Operators

Add a script to automatically escape problematic characters in TypeDoc output.

**Pros**:
- Preserves MDX functionality
- Can handle any special characters

**Cons**:
- Requires additional build step
- Must run after every TypeDoc generation
- More complex maintenance

**Implementation** (`scripts/fix-typedoc-mdx.js`):
```javascript
const fs = require('fs');
const glob = require('glob');

const files = glob.sync('docs-site/docs/api/frontend/**/*.md');

files.forEach(file => {
  let content = fs.readFileSync(file, 'utf8');

  // Escape comparison operators in inline code
  content = content.replace(/(?<!`)(<=|>=|<>)(?!`)/g, (match) => {
    return `\`${match}\``;
  });

  fs.writeFileSync(file, content);
});

console.log(`Fixed ${files.length} files`);
```

Add to `package.json`:
```json
{
  "scripts": {
    "docs:generate": "typedoc && node scripts/fix-typedoc-mdx.js"
  }
}
```

### Option C: Configure TypeDoc Plugin for MDX Compatibility

Use TypeDoc plugin to generate MDX-compatible output.

**Pros**:
- Solves problem at source
- Clean solution

**Cons**:
- May require custom TypeDoc plugin development
- Dependency on third-party solution

**Research Required**:
- Check for existing TypeDoc MDX plugins
- Evaluate `typedoc-plugin-mdx` if available

## Acceptance Criteria

- [ ] Docusaurus build completes without MDX parsing errors
- [ ] All TypeDoc-generated documentation renders correctly
- [ ] Operators (`<=`, `>=`, `<>`) display properly in descriptions
- [ ] Solution is automated (no manual intervention per build)
- [ ] Documentation maintains full functionality
- [ ] CI/CD pipeline builds successfully
- [ ] Mobile-friendly rendering preserved

## Tasks

### Phase 1: Solution Selection (1 hour)
- [ ] Test Option A (exclude from MDX) with sample files
- [ ] Test Option B (post-processing script) with sample files
- [ ] Research Option C (TypeDoc MDX plugin)
- [ ] Document test results
- [ ] Select final approach

### Phase 2: Implementation (2 hours)
- [ ] Implement chosen solution
- [ ] Test with full TypeDoc output
- [ ] Verify all affected files render correctly
- [ ] Add solution to build pipeline
- [ ] Update npm scripts if needed

### Phase 3: Validation & Documentation (1 hour)
- [ ] Run full Docusaurus build
- [ ] Verify all pages load correctly
- [ ] Test navigation and search
- [ ] Check mobile responsiveness
- [ ] Update `docs/contributing/TSDOC_TEMPLATES.md` with solution notes
- [ ] Document solution in README or contributing guide

## Testing

### Test Cases
1. **Build Success**: `npm run build` completes without errors
2. **Operator Rendering**: Pages with `<=`, `>=` display correctly
3. **Code Examples**: Inline and block code preserves formatting
4. **Links**: Cross-references and GitHub links work
5. **Search**: Search functionality indexes content properly
6. **Mobile**: Documentation responsive on mobile devices

### Affected Files to Verify
- `docs-site/docs/api/frontend/components/screener/RangeFilter/functions/default.md`
- Any other files with comparison operators in descriptions

## Documentation

- [ ] Document chosen solution in `TSDOC_TEMPLATES.md`
- [ ] Update build instructions in `docs-site/README.md`
- [ ] Add troubleshooting section for similar issues

## Definition of Done

- [ ] Solution implemented and tested
- [ ] Docusaurus build succeeds without errors
- [ ] All documentation renders correctly
- [ ] Solution is automated in build pipeline
- [ ] Documentation updated
- [ ] PR created and reviewed
- [ ] PR merged to main

## References

- [MDX Documentation](https://mdxjs.com/)
- [Docusaurus MDX Configuration](https://docusaurus.io/docs/markdown-features)
- [TypeDoc Plugin Development](https://typedoc.org/guides/development/)
- [Related Issue: DOC-003](./DOC-003.md)

## Notes

- This issue is **not blocking** for viewing documentation (raw Markdown works fine)
- Consider impact on future CI/CD automation (DOC-006)
- Solution should be reusable for backend API docs (DOC-002) if similar issues arise
