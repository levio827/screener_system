# [FE-008] Watchlist Management Feature

## Metadata
- **Status**: TODO
- **Priority**: High
- **Assignee**: Frontend Team
- **Estimated Time**: 14 hours
- **Sprint**: Phase 2 Enhancement
- **Tags**: #frontend #watchlist #user-feature #portfolio
- **Dependencies**: BE-007 (Watchlist API)

## Description
Implement a comprehensive watchlist management feature that allows users to organize, track, and analyze their favorite stocks. This is a core feature mentioned in the PRD as part of future portfolio management capabilities.

## Problem Statement
- Users cannot save stocks for later reference
- No way to organize stocks into multiple lists (e.g., "Tech Stocks", "Value Plays", "Watch for Dip")
- Cannot track price changes for favorite stocks
- Missing efficient way to monitor multiple stocks simultaneously

## Proposed Solution
Build a full-featured watchlist system with:
1. Multiple named watchlists (e.g., "My Favorites", "Tech", "Dividends")
2. Quick add/remove stocks from any page
3. Real-time price updates for watchlist stocks
4. Sorting and filtering within watchlists
5. Performance metrics and alerts (future enhancement)

## Feature Specifications

### 1. Watchlist Page (`/watchlists`)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  My Watchlists                          [+ Create Watchlist] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Sidebar (List of Watchlists)     â”‚   Main Area              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ðŸ“‹ My Favorites (12)     â”‚â—„â”€â”€â”€â”¼â”€â”€â”€â”‚ My Favorites     â”‚  â”‚
â”‚  â”‚ ðŸ’¼ Tech Stocks (8)       â”‚    â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ðŸ’° Value Plays (5)       â”‚    â”‚   â”‚ Sort: â–³ % Change â”‚  â”‚
â”‚  â”‚ ðŸ‘€ Watch for Dip (3)     â”‚    â”‚   â”‚ [Search...]      â”‚  â”‚
â”‚  â”‚                          â”‚    â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ [+ New Watchlist]        â”‚    â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚ â”‚ STOCK TABLE  â”‚ â”‚  â”‚
â”‚                                   â”‚   â”‚ â”‚ - Code       â”‚ â”‚  â”‚
â”‚                                   â”‚   â”‚ â”‚ - Name       â”‚ â”‚  â”‚
â”‚                                   â”‚   â”‚ â”‚ - Price      â”‚ â”‚  â”‚
â”‚                                   â”‚   â”‚ â”‚ - Change %   â”‚ â”‚  â”‚
â”‚                                   â”‚   â”‚ â”‚ - Volume     â”‚ â”‚  â”‚
â”‚                                   â”‚   â”‚ â”‚ - [Remove]   â”‚ â”‚  â”‚
â”‚                                   â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚                                   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Quick Add Widget (Available on all pages)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 005930 (Samsung)    â”‚
â”‚ [â­ Add to Watchlist]â”‚
â”‚                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœ“ My Favorites  â”‚ â”‚
â”‚ â”‚ â–¡ Tech Stocks   â”‚ â”‚
â”‚ â”‚ â–¡ Value Plays   â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚ + New Watchlist â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Watchlist Features
- **Create/Rename/Delete** watchlists
- **Add/Remove** stocks to/from watchlists
- **Multi-select** stocks for bulk operations
- **Sort** by price, change %, volume, market cap
- **Filter** by market (KOSPI/KOSDAQ)
- **Search** within watchlist
- **Export** watchlist to CSV
- **Share** watchlist via URL (optional)

### 4. Real-time Updates
- Live price updates via WebSocket
- Color-coded price changes (green/red)
- Visual indicators for significant moves (>5%)
- Automatic refresh every 5 minutes as fallback

## Subtasks

### Phase 1: Backend API Integration (2 hours)
- [ ] Define watchlist data types and interfaces
- [ ] Create API service methods for watchlist operations
  - [ ] GET /api/v1/watchlists - Fetch all user watchlists
  - [ ] POST /api/v1/watchlists - Create new watchlist
  - [ ] PUT /api/v1/watchlists/:id - Update watchlist
  - [ ] DELETE /api/v1/watchlists/:id - Delete watchlist
  - [ ] POST /api/v1/watchlists/:id/stocks - Add stock to watchlist
  - [ ] DELETE /api/v1/watchlists/:id/stocks/:code - Remove stock
- [ ] Implement error handling and retry logic

### Phase 2: State Management (2 hours)
- [ ] Create Zustand store for watchlist state
- [ ] Implement optimistic updates
- [ ] Add cache invalidation logic
- [ ] Sync with React Query for server state

### Phase 3: Core Components (6 hours)
- [ ] Create WatchlistsPage component
- [ ] Implement WatchlistSidebar component
  - [ ] List all watchlists
  - [ ] Show stock count per watchlist
  - [ ] Highlight active watchlist
  - [ ] Create new watchlist button
- [ ] Build WatchlistContent component
  - [ ] Stock table with real-time prices
  - [ ] Sorting controls
  - [ ] Search functionality
  - [ ] Bulk select checkboxes
- [ ] Create AddToWatchlistButton component
  - [ ] Dropdown menu with watchlist options
  - [ ] Quick add/remove toggle
  - [ ] New watchlist creation inline
- [ ] Implement WatchlistDialog component
  - [ ] Create/edit watchlist modal
  - [ ] Name input and validation
  - [ ] Optional description field
  - [ ] Icon/color picker (optional)

### Phase 4: Real-time Integration (2 hours)
- [ ] Connect to existing WebSocket for live prices
- [ ] Update stock prices in watchlist table
- [ ] Implement visual indicators for price changes
- [ ] Add fallback polling for WebSocket failures

### Phase 5: Integration with Existing Pages (1 hour)
- [ ] Add "Add to Watchlist" button to StockDetailPage
- [ ] Add star icon to ResultsTable in ScreenerPage
- [ ] Show watchlist indicator on stock cards
- [ ] Update router with /watchlists route

### Phase 6: Testing & Polish (1 hour)
- [ ] Unit tests for components
- [ ] Integration tests for API calls
- [ ] E2E tests for user flows
  - [ ] Create watchlist
  - [ ] Add stock to watchlist
  - [ ] Remove stock from watchlist
  - [ ] Delete watchlist
- [ ] Performance testing with large watchlists (100+ stocks)
- [ ] Accessibility audit

## Acceptance Criteria
- [ ] User can create up to 10 watchlists (free tier limit)
- [ ] Each watchlist can contain up to 100 stocks
- [ ] Stocks can be added from screener results or stock detail page
- [ ] Stock removal is instant with optimistic updates
- [ ] Real-time price updates work correctly
- [ ] Watchlist persists across sessions (server-side storage)
- [ ] Empty state provides clear CTA to add first stock
- [ ] All CRUD operations complete in <500ms (p95)
- [ ] Responsive design works on mobile/tablet
- [ ] No data loss on network errors (retry mechanism)

## Technical Implementation

### Data Types
```typescript
interface Watchlist {
  id: string
  name: string
  description?: string
  user_id: string
  stocks: WatchlistStock[]
  created_at: string
  updated_at: string
}

interface WatchlistStock {
  code: string
  name: string
  market: 'KOSPI' | 'KOSDAQ'
  current_price: number
  change_percent: number
  volume: number
  added_at: string
}
```

### New Components
```
src/pages/
â””â”€â”€ WatchlistsPage.tsx                # Main watchlist page

src/components/watchlist/
â”œâ”€â”€ WatchlistSidebar.tsx              # Sidebar with watchlist list
â”œâ”€â”€ WatchlistContent.tsx              # Main content area with stock table
â”œâ”€â”€ AddToWatchlistButton.tsx          # Quick add button (global)
â”œâ”€â”€ WatchlistDialog.tsx               # Create/edit modal
â”œâ”€â”€ WatchlistStockTable.tsx           # Stock table with live updates
â”œâ”€â”€ WatchlistEmpty.tsx                # Empty state
â””â”€â”€ __tests__/
    â””â”€â”€ watchlist.test.tsx            # Component tests
```

### New Hooks
```typescript
src/hooks/
â”œâ”€â”€ useWatchlists.ts                  # Fetch all watchlists
â”œâ”€â”€ useWatchlist.ts                   # Fetch single watchlist
â”œâ”€â”€ useAddToWatchlist.ts              # Add stock mutation
â”œâ”€â”€ useRemoveFromWatchlist.ts         # Remove stock mutation
â”œâ”€â”€ useCreateWatchlist.ts             # Create watchlist mutation
â””â”€â”€ useDeleteWatchlist.ts             # Delete watchlist mutation
```

### State Management (Zustand)
```typescript
interface WatchlistStore {
  watchlists: Watchlist[]
  activeWatchlistId: string | null
  setActiveWatchlist: (id: string) => void
  addStockToWatchlist: (watchlistId: string, stockCode: string) => Promise<void>
  removeStockFromWatchlist: (watchlistId: string, stockCode: string) => Promise<void>
  createWatchlist: (name: string, description?: string) => Promise<void>
  deleteWatchlist: (id: string) => Promise<void>
  updateWatchlist: (id: string, updates: Partial<Watchlist>) => Promise<void>
}
```

### API Service
```typescript
// services/watchlistService.ts
export const watchlistService = {
  getAll: () => api.get<Watchlist[]>('/watchlists'),
  getById: (id: string) => api.get<Watchlist>(`/watchlists/${id}`),
  create: (data: CreateWatchlistDto) => api.post<Watchlist>('/watchlists', data),
  update: (id: string, data: UpdateWatchlistDto) => api.put<Watchlist>(`/watchlists/${id}`, data),
  delete: (id: string) => api.delete(`/watchlists/${id}`),
  addStock: (id: string, stockCode: string) => api.post(`/watchlists/${id}/stocks`, { stockCode }),
  removeStock: (id: string, stockCode: string) => api.delete(`/watchlists/${id}/stocks/${stockCode}`),
}
```

## Dependencies
- **Backend**:
  - BE-007: Watchlist CRUD API endpoints
  - BE-008: Real-time stock data API
- **Frontend**:
  - Existing WebSocket connection for live prices
  - Authentication system (already implemented)

## References
- **PRD.md**: Section 5.5 Portfolio Management
- **SDS.md**: Section 3.1 Frontend Architecture
- **Existing**: StockDetailPage, ScreenerPage
- Inspiration:
  - [Yahoo Finance Watchlists](https://finance.yahoo.com/watchlists)
  - [TradingView Watchlists](https://www.tradingview.com/watchlists/)
  - [Google Finance Portfolios](https://www.google.com/finance/portfolios)

## Progress
- **0%** - Not started

## Notes
- Implement optimistic updates for better UX (instant feedback)
- Use virtualization (react-virtual) for large watchlists
- Consider drag-and-drop reordering in future enhancement
- Watchlist should sync across devices (server-side storage)
- Implement undo/redo for accidental deletions
- Add export to CSV/Excel functionality
- Consider sharing watchlists publicly in future
- Implement bulk operations (add multiple stocks at once)

## Performance Considerations
- Virtualize stock list for watchlists with 100+ stocks
- Debounce search input (300ms)
- Batch WebSocket updates to prevent excessive re-renders
- Cache watchlist data with 5-minute TTL
- Implement pagination if watchlist exceeds 500 stocks

## Future Enhancements (Post-MVP)
- [ ] Price alerts for watchlist stocks
- [ ] Performance tracking (portfolio value over time)
- [ ] Comparison charts for multiple stocks
- [ ] News feed for watchlist stocks
- [ ] Export to PDF report
- [ ] Share watchlist via public URL
- [ ] Drag-and-drop reordering
- [ ] Watchlist analytics (sector breakdown, risk metrics)
- [ ] Import stocks from CSV

## Impact
- **User Engagement**: Users return to check their watchlists
- **Data Collection**: Understanding user interests for recommendations
- **Retention**: Watchlists create "lock-in" effect
- **Monetization**: Premium tier could offer more watchlists/stocks

## Next Steps
After completion:
- **FE-012**: User profile settings (configure watchlist limits)
- Implement price alert system (backend + frontend)
- Add news integration for watchlist stocks
- Monitor watchlist usage metrics to optimize features
