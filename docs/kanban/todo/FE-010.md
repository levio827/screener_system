# [FE-010] Stock Comparison Tool

## Metadata
- **Status**: TODO
- **Priority**: Medium
- **Assignee**: Frontend Team
- **Estimated Time**: 14 hours
- **Sprint**: Phase 2 Enhancement
- **Tags**: #frontend #comparison #analysis #visualization
- **Dependencies**: None (uses existing stock data APIs)

## Description
Develop a side-by-side stock comparison tool that allows users to compare multiple stocks across various metrics including fundamentals, technicals, and valuation. This feature helps users make informed decisions when choosing between similar stocks or building a diversified portfolio.

## Problem Statement
- Users cannot easily compare multiple stocks simultaneously
- Difficult to identify the best stock among similar companies
- No visual comparison of key metrics (P/E, ROE, growth rates, etc.)
- Cannot compare technical indicators across stocks
- Manual comparison is time-consuming and error-prone

## Proposed Solution
Build a comprehensive comparison tool (`/compare`) that enables:
1. Add up to 4-5 stocks for comparison
2. Side-by-side view of fundamental metrics
3. Visual comparison charts (bar, radar, line)
4. Technical indicator comparison
5. Valuation metrics comparison
6. Export comparison report

## Feature Specifications

### 1. Stock Selection Interface
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Compare Stocks                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [Search stock...]              [Compare up to 5]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 005930   â”‚ 000660   â”‚ 035420   â”‚ 051910   â”‚ [+ Add]  â”‚  â”‚
â”‚  â”‚ Samsung  â”‚SK Hynix  â”‚ NAVER    â”‚LG Chem   â”‚          â”‚  â”‚
â”‚  â”‚ [Ã—]      â”‚ [Ã—]      â”‚ [Ã—]      â”‚ [Ã—]      â”‚          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Comparison Table View
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Comparison Table                    [Table View | Charts]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Metric         â”‚Samsung  â”‚SK Hynix â”‚ NAVER   â”‚LG Chem  â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ Current Price  â”‚ â‚©75,000 â”‚â‚©125,000 â”‚â‚©220,000 â”‚â‚©430,000 â”‚â”‚
â”‚  â”‚ Market Cap     â”‚ 500T    â”‚ 90T     â”‚ 35T     â”‚ 75T     â”‚â”‚
â”‚  â”‚ P/E Ratio      â”‚ 12.5    â”‚ 8.3     â”‚ 28.4    â”‚ 15.2    â”‚â”‚
â”‚  â”‚ P/B Ratio      â”‚ 1.2     â”‚ 1.5     â”‚ 3.8     â”‚ 1.8     â”‚â”‚
â”‚  â”‚ ROE (%)        â”‚ 9.8     â”‚ 18.2    â”‚ 13.5    â”‚ 12.1    â”‚â”‚
â”‚  â”‚ Revenue Growth â”‚ 5.2%    â”‚ 12.5%   â”‚ 18.3%   â”‚ 8.7%    â”‚â”‚
â”‚  â”‚ Debt Ratio     â”‚ 25%     â”‚ 35%     â”‚ 15%     â”‚ 42%     â”‚â”‚
â”‚  â”‚ Dividend Yield â”‚ 2.1%    â”‚ 1.8%    â”‚ 0.5%    â”‚ 1.2%    â”‚â”‚
â”‚  â”‚ Beta           â”‚ 1.1     â”‚ 1.3     â”‚ 1.2     â”‚ 1.0     â”‚â”‚
â”‚  â”‚ RSI (14)       â”‚ 55      â”‚ 68      â”‚ 42      â”‚ 51      â”‚â”‚
â”‚  â”‚ ...            â”‚         â”‚         â”‚         â”‚         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  Highlight: ğŸŸ¢ Best | ğŸŸ¡ Average | ğŸ”´ Worst (per metric)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Visual Comparison Charts
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chart View                                                  â”‚
â”‚  [Fundamentals | Valuation | Technical | Performance]       â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Valuation Metrics - Radar Chart              â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚                    P/E Ratio                          â”‚  â”‚
â”‚  â”‚                       /\                              â”‚  â”‚
â”‚  â”‚                      /  \                             â”‚  â”‚
â”‚  â”‚        ROE â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€ P/B Ratio          â”‚  â”‚
â”‚  â”‚                  /        \                           â”‚  â”‚
â”‚  â”‚                /            \                         â”‚  â”‚
â”‚  â”‚         Debt Ratio â”€â”€â”€â”€â”€â”€â”€â”€ Growth                   â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  Legend: â— Samsung â— SK Hynix â— NAVER â— LG Chem     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Price Performance - Line Chart (1Y)          â”‚  â”‚
â”‚  â”‚  [1M | 3M | 6M | 1Y | 3Y]                            â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  [Normalized % change from start]                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Comparison Categories

**Fundamentals**
- Market Cap, Revenue, Net Income
- Revenue Growth YoY, QoQ
- Profit Margin, Operating Margin
- EPS (Earnings Per Share)

**Valuation**
- P/E Ratio, P/B Ratio, P/S Ratio
- EV/EBITDA
- PEG Ratio
- Price to Free Cash Flow

**Financial Health**
- Debt-to-Equity Ratio
- Current Ratio, Quick Ratio
- Interest Coverage
- Free Cash Flow

**Profitability**
- ROE, ROA, ROIC
- Gross Margin, Net Margin
- Asset Turnover

**Technical Indicators**
- RSI, MACD, Stochastic
- Moving Averages (50-day, 200-day)
- Volume trends
- Relative Strength vs. Market

**Performance**
- 1D, 1W, 1M, 3M, 6M, 1Y, 3Y returns
- Volatility (standard deviation)
- Sharpe Ratio
- Max Drawdown

## Subtasks

### Phase 1: Stock Selection Component (3 hours)
- [ ] Create StockComparisonPage component
- [ ] Implement stock search/autocomplete
- [ ] Build stock chip component (with remove button)
- [ ] Limit to 5 stocks maximum
- [ ] Add drag-and-drop reordering (optional)
- [ ] Persist selection in URL params for sharing
- [ ] Handle empty state (no stocks selected)

### Phase 2: Comparison Table (4 hours)
- [ ] Create ComparisonTable component
- [ ] Fetch data for all selected stocks in parallel
- [ ] Build responsive table layout
- [ ] Implement metric categories (collapsible sections)
- [ ] Add highlighting for best/worst values per metric
- [ ] Implement sorting by column
- [ ] Add tooltips for metric definitions
- [ ] Handle missing data gracefully

### Phase 3: Chart Visualizations (5 hours)
- [ ] Create ComparisonCharts component
- [ ] Implement radar chart for valuation metrics
  - [ ] Use Recharts RadarChart
  - [ ] Support 5-7 key metrics
  - [ ] Color-code by stock
- [ ] Build bar chart comparison
  - [ ] Group bars by metric
  - [ ] Color-code by stock
- [ ] Create price performance line chart
  - [ ] Normalize prices to percentage change
  - [ ] Support multiple timeframes
  - [ ] Use TradingView Lightweight Charts
- [ ] Implement chart toggle tabs
- [ ] Add chart export functionality (PNG)

### Phase 4: Data Fetching & State (2 hours)
- [ ] Create useStockComparison hook
- [ ] Fetch comparison data for multiple stocks
- [ ] Implement parallel data fetching with Promise.all
- [ ] Cache fetched data per stock
- [ ] Handle loading states per stock
- [ ] Implement error handling per stock
- [ ] Add refresh functionality

### Phase 5: Export & Sharing (1 hour)
- [ ] Implement "Export to CSV" functionality
- [ ] Add "Export to PDF" (optional)
- [ ] Create shareable URL with stock codes
- [ ] Add "Copy Link" button
- [ ] Implement social sharing (optional)

### Phase 6: Testing & Polish (2 hours)
- [ ] Unit tests for components
- [ ] Integration tests for data fetching
- [ ] Test with different stock combinations
- [ ] Mobile responsiveness
- [ ] Accessibility audit
- [ ] Performance optimization for large datasets

## Acceptance Criteria
- [ ] Users can add up to 5 stocks for comparison
- [ ] All selected stocks load data within 2 seconds
- [ ] Table view shows at least 20 key metrics
- [ ] Chart views render correctly with all stocks
- [ ] Missing data is handled gracefully (N/A or --)
- [ ] Comparison is shareable via URL
- [ ] Export to CSV works correctly
- [ ] Responsive on mobile/tablet (horizontal scroll for table)
- [ ] No errors with 2, 3, 4, or 5 stocks
- [ ] Loading states shown while fetching

## Technical Implementation

### New Components
```
src/pages/
â””â”€â”€ StockComparisonPage.tsx           # Main comparison page

src/components/comparison/
â”œâ”€â”€ StockSelector.tsx                 # Stock search and selection
â”œâ”€â”€ StockChip.tsx                     # Individual stock chip
â”œâ”€â”€ ComparisonTable.tsx               # Table view
â”œâ”€â”€ ComparisonCharts.tsx              # Chart views container
â”œâ”€â”€ RadarChartView.tsx                # Radar chart for metrics
â”œâ”€â”€ BarChartView.tsx                  # Bar chart comparison
â”œâ”€â”€ PerformanceChart.tsx              # Price performance line chart
â”œâ”€â”€ MetricTooltip.tsx                 # Metric definition tooltips
â”œâ”€â”€ ExportButton.tsx                  # Export functionality
â””â”€â”€ __tests__/
    â””â”€â”€ comparison.test.tsx           # Component tests
```

### New Hooks
```typescript
src/hooks/
â”œâ”€â”€ useStockComparison.ts             # Main comparison logic
â”œâ”€â”€ useComparisonData.ts              # Fetch multiple stocks
â””â”€â”€ useComparisonCharts.ts            # Chart data formatting
```

### Data Types
```typescript
interface ComparisonStock {
  code: string
  name: string
  market: 'KOSPI' | 'KOSDAQ'

  // Price
  current_price: number
  change_percent: number

  // Fundamentals
  market_cap: number
  revenue: number
  net_income: number
  eps: number

  // Valuation
  pe_ratio: number
  pb_ratio: number
  ps_ratio: number
  peg_ratio: number

  // Profitability
  roe: number
  roa: number
  profit_margin: number

  // Financial Health
  debt_ratio: number
  current_ratio: number

  // Technical
  rsi: number
  macd: number
  ma_50: number
  ma_200: number

  // Performance
  return_1m: number
  return_3m: number
  return_6m: number
  return_1y: number
  volatility: number
}

interface ComparisonMetric {
  key: string
  label: string
  category: 'fundamental' | 'valuation' | 'technical' | 'performance'
  format: 'currency' | 'percent' | 'number' | 'ratio'
  higher_is_better: boolean          // For highlighting
  description: string                 // For tooltip
}
```

### API Integration
```typescript
// Batch fetch comparison data
GET /api/v1/stocks/compare?codes=005930,000660,035420

// Response
{
  stocks: [
    { code: '005930', name: 'Samsung', ... },
    { code: '000660', name: 'SK Hynix', ... },
    { code: '035420', name: 'NAVER', ... }
  ]
}
```

### Routing Update
```typescript
// Add to router.tsx
{
  path: 'compare',
  element: <StockComparisonPage />,
}

// Example URL with params
/compare?stocks=005930,000660,035420,051910
```

### Utility Functions
```typescript
// utils/comparison.ts
export const highlightBestWorst = (
  values: number[],
  higherIsBetter: boolean
): ('best' | 'worst' | 'neutral')[] => {
  // Logic to highlight best/worst values
}

export const normalizePerformance = (
  prices: number[][]
): number[][] => {
  // Normalize prices to % change from start
}

export const exportToCSV = (
  stocks: ComparisonStock[],
  metrics: ComparisonMetric[]
): Blob => {
  // Convert comparison data to CSV
}
```

## Dependencies
- **Backend**:
  - Existing stock data API (should support batch fetch)
  - May need optimization for multiple stock queries
- **Frontend**:
  - Recharts for radar and bar charts
  - TradingView Lightweight Charts for performance chart
  - Existing stock data hooks

## References
- **Existing**: StockDetailPage (uses similar data)
- **PRD.md**: Section 5 Feature Requirements
- Inspiration:
  - [Yahoo Finance Stock Comparison](https://finance.yahoo.com/compare/)
  - [Finbox Stock Comparison](https://finbox.com/compare)
  - [TradingView Stock Comparison](https://www.tradingview.com/symbols/compare/)

## Progress
- **0%** - Not started

## Notes
- Implement responsive table with horizontal scroll on mobile
- Consider virtualization if metric list grows very large
- Cache comparison data to avoid redundant API calls
- Highlight cells should be color-blind friendly (icons + colors)
- Tooltips should explain what each metric means
- Consider adding "Save Comparison" feature for future reference
- URL params should be shareable (encode stock codes)
- Consider adding preset comparisons (e.g., "Big 3 Tech Stocks")

## Performance Targets
- Initial load: <2 seconds for 5 stocks
- Chart rendering: <1 second
- Table rendering: <500ms
- Export to CSV: <1 second

## Future Enhancements (Post-MVP)
- [ ] Save comparison for later
- [ ] Comparison history
- [ ] Compare against benchmarks (KOSPI, sector average)
- [ ] Peer comparison (auto-suggest similar stocks)
- [ ] Custom metric selection
- [ ] Correlation analysis
- [ ] Score/ranking system
- [ ] AI-powered recommendation ("Best for value")

## Impact
- **Decision Support**: Easier to choose between stocks
- **User Engagement**: Rich analysis encourages deeper exploration
- **Education**: Learn about metrics through tooltips
- **Retention**: Valuable tool brings users back
- **Differentiation**: Feature not common in Korean platforms

## Next Steps
After completion:
- Monitor usage to see which metrics are most viewed
- Gather feedback on missing metrics
- Consider adding sector-specific metrics
- Integrate with watchlist (compare stocks in watchlist)
